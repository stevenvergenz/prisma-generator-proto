syntax = "proto3";
package <%= service.name %>;
<% service.dependencies.forEach((d) => { %>import "<%= d %>";
<% })%>
<% service.operations.map(o => ([o.req, o.res])).flat().forEach(m => { %>
message <%= m.name %> {<%
 m.fields.forEach((f, i) => { %>
    <% if (f.type !== 'oneof') { %><%= [f.opt, f.rep, f.type, f.name].filter(f => !!f).join(' ') %> = <%= i + 1 %>;<% } %><%
    if (f.type === 'oneof') { %><%= [f.opt, f.type, f.name].filter(f => !!f).join(' ') %> {
        <% f.children.forEach((c, i) => { %><%= [c.opt, c.rep, c.type, c.name].filter(f => !!f).join(' ') %> = <%= i + 1 %>;<% }) %>
    }<% } %><% }) %>
}
<% }) %>
service <%= service.name %> {<%
 service.operations.forEach(o => { %>
    rpc <%= o.name %>(<%= o.req.name%>) returns (<%= o.res.name %>);<% }) %>
}